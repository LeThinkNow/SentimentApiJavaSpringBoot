<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SentimentAPI — Análisis de Sentimientos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark navbar-custom mb-5">
    <div class="container">
        <a class="navbar-brand fw-bold" href="#">
            <i class="bi bi-bar-chart-fill me-2"></i> SentimentAPI Analytics
        </a>
    </div>
</nav>

<div class="container pb-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">

            <div class="card card-custom bg-white">
                <div class="card-header bg-white border-bottom-0 pt-4 px-4 text-center">
                    <h3 class="fw-bold">Carga de Datos Masiva</h3>
                    <p class="text-muted">Sube tu archivo .csv para analizar múltiples opiniones.</p>
                </div>

                <div class="card-body px-4 pb-5">

                    <form th:action="@{/procesar}" method="post" enctype="multipart/form-data">
                        <div class="upload-zone mb-4 text-center p-4 p-md-5 rounded">
                            <i class="bi bi-cloud-arrow-up-fill fs-1 text-secondary mb-3"></i>
                            <h5 class="fw-bold">Arrastra tu archivo aquí</h5>

                            <div class="row justify-content-center">
                                <div class="col-12 col-md-8 col-lg-6">
                                    <input class="form-control" type="file" name="archivo" accept=".csv" required>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-dark mt-4 px-5 py-2 fw-bold rounded-pill shadow-sm">
                                <i class="bi bi-gear-wide-connected me-2"></i> Analizar CSV
                            </button>
                        </div>
                    </form>

                    <div id="resultsArea" th:if="${mostrarResultados}">

                        <div class="row g-4 mb-4">
                            <div class="col-md-6">
                                <div class="row g-3">
                                    <div class="col-12">
                                        <div class="p-3 rounded bg-success-subtle text-center border border-success-subtle">
                                            <h2 class="text-success fw-bold mb-0" id="totalPos" th:text="${totalPos}">0</h2>
                                            <small class="text-success text-uppercase fw-bold">Positivos</small>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="p-3 rounded bg-danger-subtle text-center border border-danger-subtle">
                                            <h2 class="text-danger fw-bold mb-0" id="totalNeg" th:text="${totalNeg}">0</h2>
                                            <small class="text-danger text-uppercase fw-bold">Negativos</small>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="p-3 rounded bg-secondary-subtle text-center border border-secondary-subtle">
                                            <h2 class="text-dark fw-bold mb-0" id="totalTotal" th:text="${totalTotal}">0</h2>
                                            <small class="text-dark text-uppercase fw-bold">Total</small>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <div class="card h-100 border-0 shadow-sm">
                                    <div class="card-body d-flex align-items-center justify-content-center">
                                        <div style="height: 250px; width: 100%;">
                                            <canvas id="pieChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h6 class="text-uppercase fw-bold text-muted small mb-3"><i class="bi bi-table"></i> Detalle de Comentarios</h6>
                        <div class="table-responsive">
                            <table class="table table-hover align-middle custom-table">
                                <thead class="table-light">
                                <tr>
                                    <th style="width: 60%;">Comentario</th>
                                    <th style="width: 20%;" class="text-center">Predicción</th>
                                    <th style="width: 20%;" class="text-center">Confianza</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="item : ${listaResultados}">
                                    <td th:text="${item.texto}"></td>
                                    <td class="text-center">
                                        <span th:text="${item.prevision}" th:class="${item.estiloClase}"></span>
                                    </td>
                                    <td class="text-center" th:text="${item.probabilidadPorcentaje}"></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div> </div>
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script th:src="@{/script.js}"></script>

</body>
</html>